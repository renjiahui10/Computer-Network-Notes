# 6.1、应用层概述

![image-20201023195112701](计算机网络第6章（应用层）.assets/image-20201023195112701.png)

![image-20201023200511781](计算机网络第6章（应用层）.assets/image-20201023200511781.png)

我们在浏览器的地址中输入某个网站的域名后，就可以访问该网站的内容，这个就是推动因特网飞速发展的**万维网WWW应用**，其相关的应用层协议为**超文本传送协议HTTP**

![image-20201023200819770](计算机网络第6章（应用层）.assets/image-20201023200819770.png)

用户在浏览器地址栏中输入的是“见名知意”的**域名**，而TCP/IP的网际层使用**IP地址**来表示目的主机，从域名到IP地址的转换，由属于**应用层范畴的域名系统DNS**，在后台帮用户完成

![image-20201023201028141](计算机网络第6章（应用层）.assets/image-20201023201028141.png)



常见的应用

![image-20201023201101024](计算机网络第6章（应用层）.assets/image-20201023201101024.png)



总结

![image-20201023201137047](计算机网络第6章（应用层）.assets/image-20201023201137047.png)



------



# 6.2、客户/服务器方式（C/S方式）和对等方式（P2P方式）

## 概念

![image-20201023201308269](计算机网络第6章（应用层）.assets/image-20201023201308269.png)



## 客户/服务器方式（C/S方式）

![image-20201023201610088](计算机网络第6章（应用层）.assets/image-20201023201610088.png)

处于网络边缘的主机A中运行的是客户程序，正在运行的客户程序成为客户进程，也可简称为客户，需要注意的是，运行客户进程的主机应称为客户计算机，但有时也简称为客户，处于网络边缘的主机B中运行的是服务器程序，正在运行的服务器程序成为服务器进程，也可简称为服务器，需要注意的是，运行服务器进程的主机应称为服务器计算机，但有时也简称为服务器，


## 对等方式（P2P方式）

![image-20201023202017683](计算机网络第6章（应用层）.assets/image-20201023202017683.png)

如图所示，处于网络边缘的主机C，D，E，F中运行着同一种P2P程序，例如某种网络下载工具软件，E和F中的P2P进程互为对等方，C和D中的P2P进程互为对等方，同时E和D中的P2P进程互为对等方，我们可以想象成E的P2P进程正在从F下载文件，于此同时还为D的P2P进程提供下载服务，

## 总结

![image-20201023202049202](计算机网络第6章（应用层）.assets/image-20201023202049202.png)



------



# 6.3、动态主机配置协议DHCP

## 概念

* 互联网广泛使用的**动态主机配置协议 DHCP** (Dynamic Host Configuration Protocol) 提供了**即插即用连网** (plug-and-play networking) 的机制。
* 这种机制允许一台计算机加入新的网络和获取 IP 地址，而不用手工配置。



## DHCP的作用

在之前，如果要正常访问Web服务器，需要该主机手动配置网络的相关配置信息

![image-20201023205719672](计算机网络第6章（应用层）.assets/image-20201023205719672.png)

> 如果主机数很多，就工作量大，容易出错

如果我们给网络中添加一台DHCP服务器，在该服务器中设置好，可为网络中其他各主机配置的网络配置信息，网络中各主机开机后自动启动DHCP程序，想DHCP服务器请求自己的网络配置信息。这样网络中的各主机就都可以从DHCP服务器自动获取网络配置信息，而不用手工参与，

![image-20201023210345650](计算机网络第6章（应用层）.assets/image-20201023210345650.png)



## DHCP的工作过程

**DHCP 使用客户 - 服务器方式**
* 假设网络中有两台DHCP服务器和一台用户主机，
* DHCP 使用客户-服务器方式，采用请求/应答方式工作。
* 在DHCP服务器上运行DHCP服务器进程，也可简称为DHCP服务器，在用户主机上运行DHCP客户进程，也可简称为DHCP客户，
* DHCP是TCP/IP协议体系应用层中的协议，DHCP 基于 UDP 工作（DHCP报文在运输层会被封装成为UDP用户数据报），DHCP 服务器运行在 67 号端口， DHCP客户运行在 68 号端口，这两个端口都是熟知端口
* 封装有DHCP报文的UDP用户数据报，在网络层会被封装成IP数据报，再根据所使用的网路接口，封装成相应的数据链路层的帧进行发送，例如封装成以太网帧，
* 需要 IP 地址的主机在启动时就向 DHCP 服务器广播发送发现报文
  （DHCP DISCOVER），这时该主机就成为 DHCP 客户。
* 本地网络上所有主机都能收到此广播报文，但只有 DHCP 服务器才回答此广播报文。
* DHCP 服务器先在其数据库中查找该计算机的配置信息。若找到，则返回找到的信息。若找不到，则从服务器的 IP 地址池 (address pool) 中取一个地址分配给该计算机。DHCP服务器的回答报文叫做提供报文（DHCP OFFER）。 

**DHCP交互过程**

![image-20201023211525686](计算机网络第6章（应用层）.assets/image-20201023211525686.png)

> 当启用主机的DHCP后
> **DHCP客户端将广播发送DHCP发现报文（DHCP DISCOVER）**
>
> * 事务ID
> * DHCP客户端的MAC地址
>
> **封装该报文的IP数据报的源IP地址为0.0.0.0，这是因为主机目前还未分配到IP地址**，因此使用该地址代替
>
> **目的IP地址为广播地址255.255.255.255，之所以广播发送，是因为主机现在并不知道网络中有哪几个DHCP服务器**。它们的IP地址各是什么
>对于DHCP客户，其应用层没有监听该UDP用户数据报目的端口67的进程，也就是DHCP服务器进程，因此无法交付DHCP发现报文，只能丢弃；而对于DHCP服务器，其应用层始终运行着DHCP服务器进程，因此会接受DHCP发现报文并作出响应
> **DHCP服务器收到DHCP发现报文后，根据其中封装的DHCP客户端的MAC地址来查找自己的数据库**，看是否有针对该MAC地址的配置信息，如果查到匹配信息，则使用这些配置信息来构建并发送DHCP提供报文，如果没有则采用默认配置信息来构建报文并发送

![image-20201023213058543](计算机网络第6章（应用层）.assets/image-20201023213058543.png)

> **DHCP服务端将广播发送DHCP提供报文（DHCP OFFER）**
>
> * 事务ID：DHCP客户端会与之前DHCP发现报文的事务ID做对比，来判断该DHCP提供报文是否是自己的
> * 配置信息：
>   * IP地址：DHCP服务器从自己的IP地址池中挑选待租用给主机的IP地址（使用ARP来确保所选IP地址未被网络中其他主机占用）
>   * 子网掩码
>   * 地址租期
>   * 默认网关
>   * DNS服务器
>
> 源IP地址：发送DHCP提供报文的DHCP服务器的IP
>
> 目的地址：因为目的主机还没分配到IP，所以使用广播地址

在本例中，DHCP客户会收到两个DHCP服务器发来的DHCP提供报文，DHCP客户从中选择一个，一般选择先到的，并向所选择的DHCP服务器发送DHCP请求报文

![image-20201023214542329](计算机网络第6章（应用层）.assets/image-20201023214542329.png)

> **DHCP客户端将广播发送DHCP请求报文（DHCP REQUEST）**
>
> * 事务ID
> * DHCP客户端的MAC地址
> * 接收的租约中的IP地址
> * 提供此租约的DHCP服务器端的IP地址
>
> 源地址：0.0.0.0，因为此时DHCP客户才从多个DHCP服务器中挑选一个作为自己的DHCP服务器。它首先要征得该服务器的同意，之后才能正式使用向该DHCP服务器租用的IP地址
>
> 目的地址：广播地址，这样可以一次性向所有DHCP服务器发送DHCP请求报文，来告知它们是否请求它们作为自己的DHCP服务器

在本例中，假设DHCP客户端选择DHCP服务器1作为自己的DHCP服务器，DHCP服务器1接受该请求，于是DHCP服务器1给DHCP客户端发送DHCP确认报文

![image-20201023215341522](计算机网络第6章（应用层）.assets/image-20201023215341522.png)

> 源地址IP：DHCP服务器1的IP地址
>
> 目的地址IP：广播地址
>
> **DHCP客户收到该报文后就可以使用租用的IP地址**
>
> **在使用前还会进行ARP检测**
>
> ![image-20201023215652859](计算机网络第6章（应用层）.assets/image-20201023215652859.png)

剩下流程图示

![image-20201023220114952](计算机网络第6章（应用层）.assets/image-20201023220114952.png)
> 当租用期过了一半时，DHCP客户回想DHCP服务器发送DHCP请求报文，来请求更新租用期，封装该报文的IP数据报的源地址IP地址为，DHCP客户之前租用到的IP地址，目的IP地址为DHCP服务器1的地址，DHCP服务器若同意则发回DHCP确认报文，这样DHCP客户就得到了新的租用期，DHCP服务器若不同意，则发回DHCP否认报文，这时DHCP客户必须立即停止使用之前租用的IP地址，并重新发送DHCP发现报文来重新申请IP地址，DHCP服务器若未作出响应，则在租用期过了87.5%时，DHCP客户必须重新发送DHCP请求报文，然后进行等在DHCP服务器可能做的的反应，若DHCP服务器未作出响应，则当租用期到期后，DHCP客户必须立即停止使用之前租用的IP地址，并重新发送DHCP发现报文，来重新申请IP地址，DHCP客户可以随时提前终止DHCP服务器所提供的租用期，这时只需向DHCP服务器发送DHCP释放报文段即可，


## DHCP中继代理

> 下图的网络拓扑中的各主机是否可以通过DHCP来自动获取到网络配置？
> 答，不能，该网络中的主机广播发送DHCP发现报文，但是该广播报文不会被路由器转发，而是丢弃
> 解决方法是给该路由器配置DHCP服务器的IP地址，使之成为DHCP中级代理，这样下图中黄色部分的主机就可以通过DHCP来自动获取网络配置信息了，当该路由器收到广播的DHCP发现报文后，会将其单播转发给DHCP服务器，DHCP服务器和DHCP客户通过该路由器的后续交互过程我们就不再赘述了

![image-20201023221111923](计算机网络第6章（应用层）.assets/image-20201023221111923.png)

> 使用DHCP中继代理是因为我们不用给每一个网络上都设置一个DHCP服务器，这样会使DHCP服务器的数量太多



## 总结

![image-20201023221251022](计算机网络第6章（应用层）.assets/image-20201023221251022.png)



------



# 6.4、域名系统DNS

## 概述

域名相比IP地址更容易记忆，我们一般使用域名来访问目的主机，而不是使用IP地址直接来访问，如下图所示，当我们在浏览器地址栏中输入某个Web服务器的域名时，用户主机会首先在自己的DNS告诉缓存中查找该域名对应的IP地址，如果没有找到则会向网络中的某台DNS服务器查询，DNS服务器中有域名和IP地址映射关系数据库。当DNS服务器收到DNS查询报文后，在其数据库中进行查询，之后将查询结果发送给用户主机，现在用户主机中浏览器可以通过Web服务器的IP的地址对其进行访问了

![image-20201023234832678](计算机网络第6章（应用层）.assets/image-20201023234832678.png)

因特网是否可以只使用一台DNS服务器？

不行

![image-20201023235123151](计算机网络第6章（应用层）.assets/image-20201023235123151.png)

![image-20201023235231869](计算机网络第6章（应用层）.assets/image-20201023235231869.png)

![image-20201023235457857](计算机网络第6章（应用层）.assets/image-20201023235457857.png)

> 名称相同的域名其等级未必相同

![image-20201023235617575](计算机网络第6章（应用层）.assets/image-20201023235617575.png)

![image-20201023235910545](计算机网络第6章（应用层）.assets/image-20201023235910545.png)



## 域名解析过程
下图中右边的迭代查询，主机首先想本地域名服务器进行递归查询，本地域名服务器采用迭代查询，它先向某个根域名服务器查询，根域名服务器告诉本地域名服务器下一次应查询的顶级域名服务器的IP地址，然后本地域名服务器向顶级域名服务器进行迭代查询，顶级域名服务器告诉本地域名服务器下一次应查询的权限域名服务器的IP地址，本地域名服务器向权限域名服务器进行迭代查询，权限域名服务器告诉本地域名服务器所查询的域名的IP地址，本地域名服务器最后把查询结果告诉主机
![image-20201024000255580](计算机网络第6章（应用层）.assets/image-20201024000255580.png)

![image-20201024000335147](计算机网络第6章（应用层）.assets/image-20201024000335147.png)

![image-20201024000408396](计算机网络第6章（应用层）.assets/image-20201024000408396.png)

![image-20201024002135210](计算机网络第6章（应用层）.assets/image-20201024002135210.png)



## 总结

![image-20201024002224354](计算机网络第6章（应用层）.assets/image-20201024002224354.png)



------



# 6.5、文件传送协议FTP

## 概念

![image-20201024132745558](计算机网络第6章（应用层）.assets/image-20201024132745558.png)



## 文件传送协议FTP的应用

FTP采用C/S方式（客户/服务器方式）

FTP客户计算机可将各种类型的文件上传到FTP服务器计算机

<img src="计算机网络第6章（应用层）.assets/image-20201024133155327.png" alt="image-20201024133155327" style="zoom:50%;" />

FTP客户计算机也可以从FTP服务器计算机下载文件

<img src="计算机网络第6章（应用层）.assets/image-20201024133247537.png" alt="image-20201024133247537" style="zoom:50%;" />

![image-20201024133400777](计算机网络第6章（应用层）.assets/image-20201024133400777.png)

![image-20201024133601943](计算机网络第6章（应用层）.assets/image-20201024133601943.png)

为了简单起见，我们假设FTP客户计算机与FTP服务器计算机处于用一个局域网中，在FTP服务器计算机中创建FTP服务器，可以使用第三方的FTP服务器软件，也可以使用操作系统自带的FTP服务器软件，例如可以在windows系统中，使用器自带的FTP服务器功能创建一个FTP服务器站点，具体方法比较简单，可以在网上自行查阅，下图中有所创建的FTP服务器IP地址，可以在FTP客户计算机中使用浏览器软件使用该地址访问FTP服务器，需要注意的是这里使用的是文件传送协议FTP，而不是浏览器最常用的超文本传送协议HTTP
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/b48ab575-dd51-4902-8deb-5e9613473fef)

同时也可以在FTP客户计算机中使用window系统自带的命令行工具，通过该地址来访问FTP服务器，如下图
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/dd80769d-4b3f-438a-add9-87e60335bfe3)

当然，在FTP客户计算机上也可以使用第三方的FTP客户工具软件，
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/7fb68895-b88d-493b-b4d5-0048b10d06fb)




## FTP基本工作原理

FTP服务器监听熟知端口（端口号为 21），使客户进程能够连接上。

FTP客户随机选择一个临时端口号与其建立TCP连接，这条TCP连接用于FTP客户与服务器之间传送FTP的相关控制命令（这条连接是FTP客户与服务器之间的命令通道）

![image-20201024134319922](计算机网络第6章（应用层）.assets/image-20201024134319922.png)

下图为建立数据通道的TCP连接

FTP服务器使用自己的熟知端口号20与其建立TCP连接，这条TCP连接用于FTP客户与服务器之间传送文件

![image-20201024134624114](计算机网络第6章（应用层）.assets/image-20201024134624114.png)

> 上面例子是主动模式：建立数据通道时，FTP服务器主动连接FTP客户

下图实例为被动模式（对于FTP客户与服务器之间命令通道的建立，与主动模式相同）

<img src="计算机网络第6章（应用层）.assets/image-20201024135018620.png" alt="image-20201024135018620" style="zoom:67%;" />

两种模式对比

![image-20201024135050743](计算机网络第6章（应用层）.assets/image-20201024135050743.png)

> 注意两种模式都是
>
> 控制连接在整个会话期间保持打开状态
>
> 数据连接传输完毕后就关闭



## 总结

![image-20201024135848563](计算机网络第6章（应用层）.assets/image-20201024135848563.png)



------



# 6.6、电子邮件

## 概念

![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/86776b06-3f8a-491c-a567-d883aad91b24)

上图中，发送方和接收方可以使用不同的邮件服务器，例如发送方使用qq邮件服务器，接收方使用谷歌邮件服务器。 
![image-20201024151757221](计算机网络第6章（应用层）.assets/image-20201024151757221.png)



## 邮件发送和接收过程

![image-20201024152052056](计算机网络第6章（应用层）.assets/image-20201024152052056.png)



## 简单邮件传送协议SMTP（Simple Mail Transfer Protocol）的基本工作原理

![image-20201024152628966](计算机网络第6章（应用层）.assets/image-20201024152628966.png)



## 电子邮件的信息格式

![image-20201024153425016](计算机网络第6章（应用层）.assets/image-20201024153425016.png)



## 邮件读取

![image-20201024153736033](计算机网络第6章（应用层）.assets/image-20201024153736033.png)



## 基于万维网的电子邮件

![image-20201024154039565](计算机网络第6章（应用层）.assets/image-20201024154039565.png)



## 总结

![image-20201024154744175](计算机网络第6章（应用层）.assets/image-20201024154744175.png)



------



# 6.7、万维网WWW

## 概念

**概述**

* **万维网** WWW (World Wide Web) 并非某种特殊的计算机网络。
* 万维网是一个大规模的、联机式的**信息储藏所**。
* 万维网用链接的方法能非常方便地从互联网上的一个站点访问另一个站点，从而主动地按需获取丰富的信息。
* 这种访问方式称为“**链接**”。

**万维网的工作方式**

* 万维网以**客户 - 服务器**方式工作。
* **浏览器**就是在用户计算机上的万维网**客户程序**。万维网文档所驻留的计算机则运行**服务器程序**，因此这个计算机也称为**万维网服务器**。
* 客户程序向服务器程序发出请求，服务器程序向客户程序送回客户所要的**万维网文档**。
* 在一个客户程序主窗口上显示出的万维网文档称为**页面** (page)。



![image-20201024170819303](计算机网络第6章（应用层）.assets/image-20201024170819303.png)

![image-20201024171432743](计算机网络第6章（应用层）.assets/image-20201024171432743.png)

**万维网应用举例**

访问网页

![image-20201024170923530](计算机网络第6章（应用层）.assets/image-20201024170923530.png)

> 在用户主机中使用浏览器来访问湖南科技大学的万维网服务器，也就是湖南科技大学的官方网站，我们在浏览器的地址栏中输入湖南科技大学官方网站的的域名并按下回车键，浏览器将发送请求报文给服务器，服务器收到请求报文后执行相应操作，然后给浏览器发回响应报文，浏览器解析并渲染响应报文中的内容，这样我们就可以看到网站首页了
**怎样标志分布在整个互联网上的万维网文档？**
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/3a99ee50-21e2-47f5-868e-b02e2da884ba)

![image-20201024171058583](计算机网络第6章（应用层）.assets/image-20201024171058583.png)
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/7f90088f-3e72-422d-852f-8057bd271384)
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/5fffe19f-23cb-4071-9c64-9e568cdd380c)

**万维网的文档**

![image-20201024171724030](计算机网络第6章（应用层）.assets/image-20201024171724030.png)

由HTML、CSS、JavaScript编写的万维网文档由浏览器内核负责解释和渲染，下面举例说明
下图是用HTML编写的最简单的HTML文档，用浏览器打开该HTML文档，可以看到浏览器渲染出了一个非常简单的网页，在HTML文档中，使用两个html标签来定义HTML文档的范围，在其内部使用两个head标签定义HTML文档的首部，使用两个body标签定义HTML文档的主体，首部中两个title标签的内容被渲染为网页的标题，两个p标签之间的内容被渲染为一个文本段落，通过本例可以看出HTML使用多种标签来描述网页的结构和内容，但是所呈现出来的内容样式过于简单，或者说不够美观，我们可以在CSS文档中定义一些所需的样式对网页显示内容进行美化。
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/2402433d-7463-49b3-b2be-c1a21d1d0f39)

例如我们编写了一个这样的CSS文档，在其中那个定义了一种样式，即颜色为深粉色，字体大小为36像素，然后我们在之前编写好的HTML文档的首部，使用link标签将该CSS文档引入，将样式名称指定给主体中需要更改样式的那个p标签，现在我们在浏览器中刷新，就可以看到浏览器重新渲染除了网页内容，“hello，world”段落的颜色和字体都发生了相应的变化
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/6c179e82-57a2-49e4-888d-73d496483584)

接下来我们再给网页添加一个按钮，在之前的HTML文档的主体中使用button标签来添加一个按钮，我们为该按钮指定一个发生单击事件时应该调用的处理函数，然后用Javascript脚本语言编写一个JS文档，在该文档中编写单击事件处理函数的具体实现代码，在HTML文档的首部使用script标签将该JS文档引入，在事件处理函数中，通过元素的ID来找到相应的元素，也就是显示“hello world”的p标签，然后更改其显示内容，现在我们在浏览器中刷新就可以看到添加的按钮，
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/8721ce19-4a5c-466f-b96d-4c3347f740eb)

这些文档的具体编写属于web前端开发的基础，并不属于本课程的教学大纲，需要大家注意，这些文档都部署在服务器段，有一些时Web前端开发人员设计好的静态页面，也有一些时服务器后端程序根据用户需求自动生成的动态页面，它们都需要从服务器传送给用户浏览器进行解析和渲染，

## 超文本传输协议HTTP（Hyper Transfer Protocol）

### 概念和传输过程

* 在万维网客户程序与万维网服务器程序之间进行交互所使用的协议，是**超文本传送协议** HTTP (HyperText Transfer Protocol)。
* HTTP 是一个应用层协议，它使用 TCP 连接进行可靠的传送。 

![image-20201024222457800](计算机网络第6章（应用层）.assets/image-20201024222457800.png)

* 每个万维网网点都有一个服务器进程，它不断地**监听 TCP 的端口 80**，以便发现是否有浏览器向它发出连接建立请求。
* 一旦监听到连接建立请求并建立了 TCP 连接之后，浏览器就向万维网服务器发出浏览某个页面的请求，服务器接着就返回所请求的页面作为响应。
* 最后，TCP 连接就被释放了。

![image-20201024222825888](计算机网络第6章（应用层）.assets/image-20201024222825888.png)

上图中三报文握手时在第三个报文也就是确认报文中就已经由数据载荷部分了，也就是HTTP请求报文，


### HTTP报文格式

**HTTP请求报文格式**

![image-20201024224828528](计算机网络第6章（应用层）.assets/image-20201024224828528.png)



**HTTP响应报文格式**
在我们访问网站时，浏览器通常会使用Cookie在服务器上记录用户信息，
![image-20201024224920638](计算机网络第6章（应用层）.assets/image-20201024224920638.png)



### 使用Cookie在服务器上记录用户信息

![image-20201024224945200](计算机网络第6章（应用层）.assets/image-20201024224945200.png)

上图中服务器发回的HTTP响应报文，在响应报文中包含一个首部字段为SET-Cookie的首部行，该字段的取值就是Cookie识别码，当浏览器进程收到该响应报文后，就在一个特定的Cookie文件中添加一行，记录该服务器的域名和Coolie识别码，当用户再次使用该浏览器访问这个网站时，每发送一个HTTP请求报文，浏览器都会从Cookie问价中取出该网站的Cookie识别码，并放到HTTP请求报文的Cookie首部行中，服务器根据Cookie识别码就可以识别出该用户，并返回该用户的个性网页，
![image](https://github.com/renjiahui10/Computer-Network-Notes/assets/114166264/9a34bef3-fced-4f4a-a012-0c778dc833dd)

“记住我”就是这样实现的

### 万维网缓存与代理服务器

![image-20201024224632514](计算机网络第6章（应用层）.assets/image-20201024224632514.png)

如果该请求有缓存

![image-20201024224720124](计算机网络第6章（应用层）.assets/image-20201024224720124.png)

如果该请求没有缓存

![image-20201024225013288](计算机网络第6章（应用层）.assets/image-20201024225013288.png)

> 若WEb缓存的命中率比较高
>
> 则会大大减小了该链路上的通信量，因而减少了访问因特网的时延

假设原始服务器的文档被更改，这样代理服务器的文档就不是最新的

所以原始服务器通常会为每个响应的对象设定一个**修改时间字段**和一个**有效日期字段**

若未过期

![image-20201024225504869](计算机网络第6章（应用层）.assets/image-20201024225504869.png)

若过期并且代理服务器的文档和原始服务器的**文档一致**，原始服务器则给代理服务器发送不包含实体主体的响应

![image-20201024225846863](计算机网络第6章（应用层）.assets/image-20201024225846863.png)



若过期并且代理服务器的文档和原始服务器的**文档不一致**，原始服务器则给代理服务器发送封装有该文档的响应报文

![image-20201024230242550](计算机网络第6章（应用层）.assets/image-20201024230242550.png)



## 总结

![image-20201024231143505](计算机网络第6章（应用层）.assets/image-20201024231143505.png)

